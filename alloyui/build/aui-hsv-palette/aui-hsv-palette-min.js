YUI.add("aui-hsv-palette",function(e,t){var n=e.Color,r=e.Widget,i=e.Lang,s=e.getClassName,o=3,u=3,a=6,f=3,l=3,c=3,h=3,p=100,d=360,v=100,m=100,g=100,y=0,b=0,w=0,E=0,S=0,x=0,T=".control-group.error",N=".control-group",C=".hsv-value",k=s("hsv-container"),L=s("hsv-container-controls"),A=s("hsv-view-container"),O=s("hsv-image-backdrop"),M=s("hsv-view-backdrop"),_=s("hsv-hs-container"),D=s("hsv-hs-thumb"),P=s("hsv-value-slider-container"),H=s("hsv-value-canvas"),B=s("hsv-value-thumb"),j=s("hsv-value-image"),F=s("hsv-result-view"),I=s("hsv-label-value-container"),q=s("hsv-label-value-hsv-container"),R=s("hsv-label-value-rgb-container"),U=s("hsv-label-value-hex-container"),z=s("hsv-label-value"),W=s("hsv-label-value-hex"),X=s("hsv-label-hidden"),V=s("hsv-label"),$=s("hsv-value"),J=/^([a-f0-9]{6}|[a-f0-9]{3})$/i,K=/^([0-9]|[1-9][0-9]|100)$/,Q=/^([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])$/,G=/^([0]{0,2}[1-9]|[0]?[1-9][0-9]|[12][0-9][0-9]|3[0-5][0-9]|360)$/,Y=e.Base.create("hsv-palette",e.Widget,[e.WidgetCssClass,e.WidgetToggle],{TPL_CONTAINER:'<div class="'+k+' {subClass}"><div>',TPL_VIEW_CONTAINER:'<div class="'+A+'"><div>',TPL_IMAGE_BACKDROP:'<div class="'+O+'"><div>',TPL_VIEW_BACKDROP:'<div class="'+M+'"><div>',TPL_HS_CONTAINER:'<div class="'+_+'"><div>',TPL_HS_THUMB:'<div class="'+D+'"><div>',TPL_VALUE_SLIDER_CONTAINER:'<div class="'+P+'"><div>',TPL_VALUE_CANVAS:'<span class="'+H+'"></span>',TPL_VALUE_THUMB:'<span class="'+B+'"><span class="'+j+'"></span></span>',TPL_RESULT_VIEW:'<div class="'+F+'"></div>',TPL_LABEL_VALUE_CONTAINER:'<div class="'+I+' {subClass}"></div>',TPL_OUTPUT:'<div class="control-group '+z+" "+W+'">'+"<label>{label}</label>"+'<div class="controls">'+'<input class="'+$+'" data-type="{type}" type="text" maxlength="{maxlength}" value="{value}">'+"</div>"+"</div>",TPL_LABEL_VALUE:'<div class="control-group input-prepend input-append"><label class="add-on">{label}</label><input class="span2 '+$+'" data-type="{type}" type="text" maxlength="{maxlength}" value="{value}">'+'<label class="'+V+'">{labelUnit}</label>'+"</div>",_outputType:"hex",initializer:function(){var e=this;e.onceAfter("render",e._createSliders,e),e.on("selectedChange",e._onSelectedChange,e)},bindUI:function(){var e=this;e._hsContainer.after("mousedown",e._afterPaletteMousedown,e),e._paletteContainer.delegate("input",e._afterInputChange,C,e),e._bindDD()},destructor:function(){var e=this;e._dd.destroy()},renderUI:function(){var e=this;e._renderContainer(),e.get("contentBox").appendChild(e._paletteContainer),e._colorThumbGutter=Math.floor(e._colorThumb.get("offsetHeight")/2),e._hsContainerWidth=e._hsContainer.get("clientWidth"),e._hsContainerHeight=e._hsContainer.get("clientHeight")},_afterInputChange:function(e){var t=this,n,r,i;n=e.currentTarget,t._validateFieldValue(n)?(i=n.get("value"),r=n.getAttribute("data-type"),n.ancestor(N).removeClass("error")):n.ancestor(N).addClass("error"),t._paletteContainer.one(T)||t._updateViewFromInput(n)},_afterHSThumbChange:function(e,t){var i=this,s,o,u,a,f,l,c;u=i._calculateHue(e),l=i._calculateSaturation(t),c=m-i._valueSlider.get("value"),a=i._calculateRGBColor(u,l,c),f=n.toArray(a),s=n.toHex(a),o=i._getHexValue(s,f),i._resultView.setStyle("backgroundColor",s),i._setValueSliderContainerStyle(u,l),i._setFieldValue(i._outputContainer,o),i.get("controls")&&(i._setFieldValue(i._hContainer,Math.round(u)),i._setFieldValue(i._sContainer,Math.round(l)),i._setFieldValue(i._rContainer,f[0]),i._setFieldValue(i._gContainer,f[1]),i._setFieldValue(i._bContainer,f[2])),i.fire("hsThumbChange",{x:e,y:t,hexColor:s}),i.set("selected",o,{src:r.UI_SRC})},_afterPaletteMousedown:function(e){var t=this,n,r,i,s;t._updatePaletteThumbPosition([e.pageX,e.pageY]),n=t._hsContainer.getXY(),r=t._colorThumb.getXY(),i=r[0]-n[0]+t._colorThumbGutter,s=r[1]-n[1]+t._colorThumbGutter,t._afterHSThumbChange(i,s),e.target=t._colorThumb,t._dd._handleMouseDownEvent(e)},_afterPaletteDragStart:function(){var e=this;e._setHSContainerXY()},_afterPaletteThumbDrag:function(e){var t=this,n,r;n=e.pageX-t._hsContainerXY[0]+t._colorThumbGutter,r=e.pageY-t._hsContainerXY[1]+t._colorThumbGutter,t._afterHSThumbChange(n,r)},_bindDD:function(){var t=this,n;n=(new e.DD.Drag({node:t._colorThumb})).plug(e.Plugin.DDConstrained,{constrain2node:t._hsContainer,gutter:"-"+t._colorThumbGutter}),n.after("start",t._afterPaletteDragStart,t),n.after("drag",t._afterPaletteThumbDrag,t),t._dd=n},_calculateRGBColor:function(e,t,n){var r=this;return r._calculateRGB(e,t,n)},_calculateHue:function(e){var t=this,n;return e<=w?n=w:e>=t._hsContainerWidth?n=d:n=e/t._hsContainerWidth*d,Math.round(n)},_calculateRGB:function(e,t,r){var s="rgb(255, 0, 0)",o;if(e!==d||i.toInt(t)!==v||i.toInt(r)!==m)o="hsva("+(e===d?d-1:e)+", "+t+"%, "+r+"%"+")",s=n.toRGB(o);return s},_calculateRGBArray:function(e,t,r){var i=this;return n.fromArray([e,t,r],"RGB")},_calculateSaturation:function(e){var t=this,n;return e<=S?n=v:e>=t._hsContainerHeight?n=S:n=v-e/t._hsContainerHeight*v,Math.round(n)},_calculateX:function(e){var t=this,n;return e<=w?n=w:e>=d?n=t._hsContainerWidth:n=e/d*t._hsContainerWidth,n},_calculateY:function(e){var t=this,n;return e<=S?n=t._hsContainerHeight:e>=v?n=S:n=t._hsContainerHeight/v*(v-e),n},_createSliders:function(){var e=this;e._createValueSlider()},_createValueSlider:function(){var t=this,n,r,i;n=t.get("contentBox"),r=new e.Slider({axis:"y",min:x,max:m}),r.RAIL_TEMPLATE=t.TPL_VALUE_CANVAS,r.THUMB_TEMPLATE=t.TPL_VALUE_THUMB,r.render(t._valueSliderContainer),i=n.one("."+j).get("offsetHeight"),r.set("length",t._valueSliderContainer.get("offsetHeight")+i/2),r.on(["slideStart","railMouseDown"],t._setHSContainerXY,t),r.on("valueChange",t._onValueChange,t),t._valueSlider=r},_getContainerClassName:function(){var e=this,t="";return e.get("controls")&&(t=L),t},_getFieldValue:function(e){var t=this;return e.one("."+$).get("value")},_getHexValue:function(e,t){return e.substring(1)},_getHexContainerConfig:function(){var e=this;return{label:e.get("strings").hex
,maxlength:a,type:"hex",unit:"",value:"ff0000"}},_getHSVArray:function(e){var t=this;return n.toArray(e,"HSV")},_getXYFromHueSaturation:function(e,t){var n=this,r,i;return r=n._calculateX(e),i=n._calculateY(t),[r,i]},_normalizeHexValue:function(e){var t="";return e.indexOf("#")===0&&(e=e.substring(1)),e.length===3&&(t="fff"),(e+=t).toUpperCase()},_onSelectedChange:function(e){var t=this;e.src!==r.UI_SRC&&t._updateViewByHEX(e.newVal)},_onValueChange:function(e){var t=this,i,s,o,u,a,f,l,c,h,p;e.src!==r.UI_SRC&&(c=e.newVal,t._hsContainer.setStyle("opacity",1-c/m),l=t._colorThumb.getXY(),h=l[0]-t._hsContainerXY[0]+t._colorThumbGutter,p=l[1]-t._hsContainerXY[1]+t._colorThumbGutter,o=t._calculateHue(h),f=t._calculateSaturation(p),c=m-c,u=t._calculateRGBColor(o,f,c),a=n.toArray(u),i=n.toHex(u),s=t._getHexValue(i,a),t._resultView.setStyle("backgroundColor",i),t._setFieldValue(t._outputContainer,s),t.get("controls")&&(t._setFieldValue(t._vContainer,c),t._setFieldValue(t._rContainer,a[0]),t._setFieldValue(t._gContainer,a[1]),t._setFieldValue(t._bContainer,a[2])),t.fire("valueChange",{value:c,hexColor:i}),t.set("selected",s,{src:r.UI_SRC}))},_renderContainer:function(){var t=this,n;n=t._getContainerClassName(),t._paletteContainer=e.Node.create(i.sub(t.TPL_CONTAINER,{subClass:n})),t._renderViewContainer()},_renderViewContainer:function(){var t=this;t._viewContainer=e.Node.create(t.TPL_VIEW_CONTAINER),t._renderViewContainerContent(),t._paletteContainer.appendChild(t._viewContainer)},_renderViewContainerContent:function(){var e=this;e._renderImageBackdrop(),e._renderHSContainer(),e._renderThumb(),e._renderValueSliderContainer(),e._renderResultBackdrop(),e._renderResultView(),e.get("controls")&&e._renderFields(),e._renderHexNode()},_renderField:function(e,t){var n=this;return e.appendChild(i.sub(n.TPL_LABEL_VALUE,{classLabel:t.classLabel||"",label:t.label,labelUnit:t.unit,maxlength:t.maxlength,type:t.type,value:t.value}))},_renderOutputField:function(e,t){var n=this;return e.appendChild(i.sub(n.TPL_OUTPUT,{label:t.label,maxlength:t.maxlength,type:t.type,value:t.value}))},_renderHexNode:function(){var t=this,n,r;n=e.Node.create(i.sub(t.TPL_LABEL_VALUE_CONTAINER,{subClass:U})),r=t._getHexContainerConfig(),t._outputContainer=t._renderOutputField(n,r),t._viewContainer.appendChild(n),t._labelValueRGBContainer=n},_renderFields:function(){var t=this,n,r;n=e.Node.create(i.sub(t.TPL_LABEL_VALUE_CONTAINER,{subClass:q})),r=e.Node.create(i.sub(t.TPL_LABEL_VALUE_CONTAINER,{subClass:R})),t._hContainer=t._renderField(n,{label:t.get("strings").h,maxlength:f,type:"hue",unit:"&#176;",value:w}),t._sContainer=t._renderField(n,{label:t.get("strings").s,maxlength:c,type:"saturation",unit:"%",value:v}),t._vContainer=t._renderField(n,{label:t.get("strings").v,maxlength:h,type:"value",unit:"%",value:m}),t._rContainer=t._renderField(r,{classLabel:X,label:t.get("strings").r,maxlength:l,type:"r",unit:"",value:"255"}),t._gContainer=t._renderField(r,{classLabel:X,label:t.get("strings").g,maxlength:u,type:"g",unit:"",value:b}),t._bContainer=t._renderField(r,{classLabel:X,label:t.get("strings").b,maxlength:o,type:"b",unit:"",value:y}),t._viewContainer.appendChild(n),t._viewContainer.appendChild(r),t._labelValueHSVContainer=n,t._labelValueRGBContainer=r},_renderImageBackdrop:function(){var e=this;e._hsImageBackdrop=e._viewContainer.appendChild(e.TPL_IMAGE_BACKDROP)},_renderHSContainer:function(){var e=this;e._hsContainer=e._viewContainer.appendChild(e.TPL_HS_CONTAINER)},_renderValueSliderContainer:function(){var e=this;e._valueSliderContainer=e._viewContainer.appendChild(e.TPL_VALUE_SLIDER_CONTAINER)},_renderResultBackdrop:function(){var e=this;e._resultViewBackdrop=e._viewContainer.appendChild(e.TPL_VIEW_BACKDROP)},_renderResultView:function(){var e=this;e._resultView=e._viewContainer.appendChild(e.TPL_RESULT_VIEW)},_renderThumb:function(){var e=this;e._colorThumb=e._viewContainer.appendChild(e.TPL_HS_THUMB)},_setHSContainerXY:function(){var e=this;e._hsContainerXY=e._hsContainer.getXY()},_setFieldValue:function(e,t){var n=this;e.one("."+$).set("value",t)},_setValueSliderContainerStyle:function(e,t){var n=this,r;r=n._calculateRGBColor(e,t,100),n._valueSliderContainer.setStyle("backgroundColor",r)},_updatePaletteThumbPosition:function(e){var t=this;t._colorThumb.setXY([e[0]-t._colorThumbGutter,e[1]-t._colorThumbGutter])},_updateViewFromInput:function(e){var t=this,n;n=e.getAttribute("data-type"),n==="hue"||n==="saturation"||n==="value"||n==="alpha"?t._updateViewByHSVA(e):n==="r"||n==="g"||n==="b"?t._updateViewByRGB(e):n==="hex"&&t._updateViewByHEXNode(e)},_updateViewByHSVA:function(e){var t=this,i,s,o,u,a,f,l,c;o=t._getFieldValue(t._hContainer),l=t._getFieldValue(t._sContainer),c=t._getFieldValue(t._vContainer),u=t._getXYFromHueSaturation(o,l),t._colorThumb.setStyles({left:u[0],top:u[1]}),t._valueSlider.set("value",m-c,{src:r.UI_SRC}),a=t._calculateRGBColor(o,l,c),f=n.toArray(a),i=n.toHex(a),s=t._getHexValue(i,f),t._resultView.setStyle("backgroundColor",i),t._setValueSliderContainerStyle(o,l),t._hsContainer.setStyle("opacity",1-(g-c)/g),t._setFieldValue(t._outputContainer,s),t.get("controls")&&(t._setFieldValue(t._rContainer,f[0]),t._setFieldValue(t._gContainer,f[1]),t._setFieldValue(t._bContainer,f[2])),t.fire("hsvaInputChange",{hexColor:i,node:e}),t.set("selected",s,{src:r.UI_SRC})},_updateViewByRGB:function(e){var t=this,i,s,o,u,a,f,l,c,h,p,d,v,y,b;h=t._getFieldValue(t._rContainer),s=t._getFieldValue(t._gContainer),i=t._getFieldValue(t._bContainer),p=t._calculateRGBArray(h,s,i),a=n.toHSV(p),f=t._getHSVArray(a),l=f[0],y=f[1],b=f[2],d=t._calculateRGBColor(l,y,b),v=n.toArray(d),o=n.toHex(d),u=t._getHexValue(o,v),c=t._getXYFromHueSaturation(l,y),t._colorThumb.setStyles({left:c[0],top:c[1]}),t._valueSlider.set("value",m-b,{src:r.UI_SRC}),t._resultView.setStyle("backgroundColor",o),t._setValueSliderContainerStyle(l,y),t._hsContainer.setStyle("opacity",1-(g-b)/g),t._setFieldValue(t._outputContainer,u),t.get("controls")&&(t._setFieldValue(t
._hContainer,l),t._setFieldValue(t._sContainer,y),t._setFieldValue(t._vContainer,b)),t.fire("rgbInputChange",{hexColor:o,node:e}),t.set("selected",u,{src:r.UI_SRC})},_updateViewByHEXNode:function(e){var t=this,n;n=e.get("value"),t._updateViewByHEX(n),t.fire("hexInputChange",{hexColor:n,fieldNode:e}),t.set("selected",n,{src:r.UI_SRC})},_updateViewByHEX:function(e){var t=this,i,s,o,u,a,f,l,c,h,p,d,v,y,b;u=t._normalizeHexValue(e),u=u.substr(0,6),f=n.toHSV(u),l=n.toArray(f,"HSV"),c=l[0],y=l[1],b=l[2],d=n.toRGBA(f),v=n.toArray(d),p=v[0],o=v[1],i=v[2],h=t._getXYFromHueSaturation(l[0],l[1]),t._colorThumb.setStyles({left:h[0],top:h[1]}),t._valueSlider.set("value",m-b,{src:r.UI_SRC}),a="#"+u,t._resultView.setStyle("backgroundColor",a),t._setValueSliderContainerStyle(c,y),t._hsContainer.setStyle("opacity",1-(g-b)/g),t.get("controls")&&(s=t._getFieldValue(t._outputContainer),e.toLowerCase()!==s.toLowerCase()&&t._setFieldValue(t._outputContainer,e),t._setFieldValue(t._hContainer,c),t._setFieldValue(t._sContainer,y),t._setFieldValue(t._vContainer,b),t._setFieldValue(t._rContainer,p),t._setFieldValue(t._gContainer,o),t._setFieldValue(t._bContainer,i))},_validateFieldValue:function(e){var t=this,n,r,i,s;return n=t.get("fieldValidator"),i=n[e.getAttribute("data-type")],r=!1,s=e.get("value"),i&&i.test(s)&&(r=!0),r}},{CSS_PREFIX:s("hsv-palette"),ATTRS:{controls:{validator:i.isBoolean,value:!0,writeOnce:!0},fieldValidator:{validator:i.isObject,value:{alpha:Q,b:Q,g:Q,hex:J,hue:G,r:Q,saturation:K,value:K}},selected:{validator:i.isString,value:""},strings:{value:{a:"A",b:"B",g:"G",h:"H",r:"R",hex:"Hex",s:"S",v:"V"}}},NAME:"hsv-palette",NS:"hsv-palette"});e.HSVPalette=Y},"2.5.0",{requires:["aui-classnamemanager","aui-widget-cssclass","aui-widget-toggle","aui-event-input","base-build","clickable-rail","color-hsv","dd-constrain","slider","widget"],skinnable:!0});
