YUI.add("aui-tree-data",function(e,t){var n=e.Lang,r=n.isArray,i=n.isBoolean,s=n.isObject,o=n.isUndefined,u=function(t){return e.instanceOf(t,e.TreeNode)},a=function(t){return e.instanceOf(t,e.TreeView)},f=e.getClassName,l=f("tree","node"),c=function(){};c.ATTRS={container:{setter:e.one},children:{value:[],validator:r,setter:"_setChildren"},index:{value:{}}},e.mix(c.prototype,{_indexPrimed:!1,childrenLength:0,initializer:function(){var e=this;e.publish("move"),e.publish("append",{defaultFn:e._appendChild}),e.publish("remove",{defaultFn:e._removeChild})},destructor:function(){var e=this;e.eachChildren(function(e){e.destroy()},!0)},getNodeById:function(e){var t=this;return t._indexPrimed||t.refreshIndex(),t.get("index")[e]},isRegistered:function(e){var t=this;return!!t.get("index")[e.get("id")]},updateReferences:function(t,n,r){var i=this,s=t.get("parentNode"),o=t.get("ownerTree"),u=s&&s!==n;if(s){if(u){var a=s.get("children");e.Array.removeItem(a,t),s.set("children",a)}s.unregisterNode(t)}o&&o.unregisterNode(t),t.set("parentNode",n),t.set("ownerTree",r),n&&n.registerNode(t),r&&r.registerNode(t),o!=r&&t.eachChildren(function(e){i.updateReferences(e,e.get("parentNode"),r)});if(u){var f=i.getEventOutputMap(t);s.get("children").length||s.collapse(),f.tree.oldParent=s,f.tree.oldOwnerTree=o,i.bubbleEvent("move",f)}},refreshIndex:function(){var e=this;e.updateIndex({}),e.eachChildren(function(t){e.registerNode(t)},!0)},registerNode:function(e){var t=this,n=e.get("id"),r=t.get("index");n&&(r[n]=e),a(t)&&(e.addTarget(t),e.set("ownerTree",t)),e._inheritOwnerTreeAttrs(),t.updateIndex(r)},updateIndex:function(e){var t=this;e&&(t._indexPrimed=!0,t.set("index",e))},unregisterNode:function(e){var t=this,n=t.get("index");delete n[e.get("id")],a(t)&&e.removeTarget(t),t.updateIndex(n)},collapseAll:function(){var e=this;e.eachChildren(function(e){e.collapse()},!0)},expandAll:function(){var e=this;e.eachChildren(function(e){e.expand()},!0)},selectAll:function(){var e=this;e.eachChildren(function(e){e.select()},!0)},unselectAll:function(){var e=this;e.eachChildren(function(e){e.unselect()},!0)},eachChildren:function(t,n){var r=this,i=r.getChildren(n);e.Array.each(i,function(e){e&&t.apply(r,arguments)})},eachParent:function(e){var t=this,n=t.get("parentNode");while(n)n&&e.call(t,n),n=n.get("parentNode")},bubbleEvent:function(e,t,n,r){var i=this;i.fire(e,t);if(!n){var s=i.get("parentNode");t=t||{},o(r)&&(r=!0),t.stopActionPropagation=r;while(s)s.fire(e,t),s=s.get("parentNode")}},createNode:function(t){var n=this,r=e.TreeNode.nodeTypes[s(t)?t.type:t]||e.TreeNode;return new r(s(t)?t:{})},appendChild:function(e,t){var n=this,r=n.getEventOutputMap(e);n.bubbleEvent("append",r,t)},_appendChild:function(e){if(e.stopActionPropagation)return!1;var t=this,n=e.tree.node,r=t.get("ownerTree"),i=t.get("children");t.updateReferences(n,t,r);var s=i.push(n);t.set("children",i);var o=s-2,u=t.item(o);n._nextSibling=null,n._prevSibling=u,n.render(t.get("container"))},item:function(e){var t=this;return t.get("children")[e]},indexOf:function(t){var n=this;return e.Array.indexOf(n.get("children"),t)},hasChildNodes:function(){var e=this;return e.getChildrenLength()>0},getChildren:function(e){var t=this,n=[],r=t.get("children");return n=n.concat(r),e&&t.eachChildren(function(t){n=n.concat(t.getChildren(e))}),n},getChildrenLength:function(){var e=this;return e.childrenLength||e.get("children").length},getEventOutputMap:function(e){var t=this;return{tree:{instance:t,node:e||t}}},removeChild:function(e){var t=this,n=t.getEventOutputMap(e);t.bubbleEvent("remove",n)},_removeChild:function(t){if(t.stopActionPropagation)return!1;var n=this,r=t.tree.node,i=n.get("ownerTree");if(n.isRegistered(r)){r.set("parentNode",null),n.unregisterNode(r),r.set("ownerTree",null),i&&i.unregisterNode(r),r.get("boundingBox").remove();var s=n.get("children");e.Array.removeItem(s,r),n.set("children",s)}},empty:function(){var e=this;e.eachChildren(function(e){var t=e.get("parentNode");t&&t.removeChild(e)})},insert:function(e,t,n){var r=this;t=t||this;if(t===e)return!1;var i=t.get("parentNode");if(e&&i){var s=e.get("boundingBox"),o=t.get("boundingBox"),u=t.get("ownerTree");n==="before"?o.placeBefore(s):n==="after"&&o.placeAfter(s);var a=[],f=i.get("boundingBox").all("> ul > li");f.each(function(e){a.push(e.getData("tree-node"))});var l=s.get("nextSibling");e.set("nextSibling",l&&l.getData("tree-node"));var c=s.get("previousSibling");e.set("prevSibling",c&&c.getData("tree-node")),t.updateReferences(e,i,u),i.set("children",a)}e.render();var h=t.getEventOutputMap(e);h.tree.refTreeNode=t,t.bubbleEvent("insert",h)},insertAfter:function(e,t){var n=this;n.insert(e,t,"after")},insertBefore:function(e,t){var n=this;n.insert(e,t,"before")},getNodeByChild:function(e){var t=this,n=e.ancestor("."+l);return n?n.getData("tree-node"):null},_inheritOwnerTreeAttrs:n.emptyFn,_setChildren:function(t){var n=this,r=[],i=n.get("container");i||(i=n._createNodeContainer()),n.childrenLength=t.length;var o=n;u(n)&&(o=n.get("ownerTree"));var f=a(o),l=!0;return f&&(l=o.get("lazyLoad")),n.updateIndex({}),n.childrenLength>0&&n.set("leaf",!1),e.Array.each(t,function(t,a){if(t){if(!u(t)&&s(t)){var c=t.children,h=c&&c.length;t.ownerTree=o,t.parentNode=n,h&&l&&delete t.children,t=n.createNode(t),h&&l&&(t.childrenLength=c.length,e.setTimeout(function(){t.set("children",c)},50))}n.registerNode(t),f&&o.registerNode(t),t.render(i),e.Array.indexOf(r,t)===-1&&r.push(t)}}),r}}),e.TreeData=c},"2.5.0",{requires:["aui-base-core","aui-base-lang","aui-node-base","aui-timer","aui-component"]});
