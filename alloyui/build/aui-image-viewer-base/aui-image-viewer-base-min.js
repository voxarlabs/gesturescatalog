YUI.add("aui-image-viewer-base",function(e,t){var n=e.Lang,r=n.isBoolean,i=n.isNumber,s=n.isObject,o=n.isString,u=e.Plugin.NodeFX,a=e.config.doc,f=function(t){return t instanceof e.NodeList},l=function(){return Array.prototype.slice.call(arguments).join(" ")},c=e.getClassName,h=c("carousel","control"),p=c("close"),d=c("helper","scroll","lock"),v=c("hide"),m=c("icon","time"),g=c("image-viewer","bd"),y=c("image-viewer","caption"),b=c("image-viewer","close"),w=c("image-viewer","control"),E=c("image-viewer","image"),S=c("image-viewer","info"),x=c("image-viewer","link"),T=c("image-viewer","loader"),N=c("image-viewer","loading"),C=c("left"),k=c("right"),L=c("well"),A={height:"auto",width:"auto"},O=a.createTextNode(""),M="Image {current} of {total}",_='<h4 class="'+y+'"></h4>',D='<button class="'+l(b,p)+'" type="button">?</button>',P='<a href="#" class="'+l(w,h,C)+'">&lsaquo;</a>',H='<a href="#" class="'+l(w,h,k)+'">&rsaquo;</a>',B='<img class="'+E+'" />',j='<h5 class="'+S+'"></h5>',F='<div class="'+T+'"></div>',I='<div class="'+m+'"></div>',q=e.Base.create("aui-image-viewer",e.Widget,[e.WidgetCssClass,e.WidgetStdMod,e.WidgetToggle,e.WidgetPosition,e.WidgetStack,e.WidgetPositionAlign,e.WidgetPositionConstrain,e.WidgetModality],{_keyHandler:null,renderUI:function(){var e=this;e._renderControls(),e._renderFooter(),e.get("links").addClass(x)},bindUI:function(){var t=this,n=t.get("links"),r=t.get("controlLeftEl"),i=t.get("controlRightEl"),s=t.get("closeEl");s.on("click",e.bind(t._onClickCloseEl,t)),r.on("click",e.bind(t._onClickLeftControl,t)),i.on("click",e.bind(t._onClickRightControl,t)),n.on("click",e.bind(t._onClickLinks,t)),t._keyHandler=e.bind(t._onKeyInteraction,t),e.getDoc().on("keydown",t._keyHandler),e.getWin().on("resize",function(){t._setAlignCenter(!0)}),t.after("render",t._afterRender),t.after("loadingChange",t._afterLoadingChange),t.after("visibleChange",t._afterVisibleChange)},destructor:function(){var t=this,n=t.get("links");t.close(),n.detach("click"),n.removeClass(x),e.getDoc().detach("keydown",t._keyHandler),t.get("controlLeftEl").remove(!0),t.get("controlRightEl").remove(!0),t.get("closeEl").remove(!0),t.get("loader").remove(!0)},close:function(){var e=this;e.hide()},getLink:function(e){var t=this;return t.get("links").item(e)},getCurrentLink:function(){var e=this;return e.getLink(e.get("currentIndex"))},loadImage:function(t){var n=this,r=n.get("loader");n.set("loading",!0);var i=n._activeImagePool;if(!i){i=[];var s=n.get("image"),o=s.clone(),u=s.clone(),a=e.bind(n._onLoadImage,n);o.on("load",a),u.on("load",a),i.push(o,u),n._activeImagePool=i}var f=i[0];f.removeAttribute("height"),f.removeAttribute("width"),f.setStyles(A),r.append(f),i.push(i.shift(f)),e.UA.webkit&&f.attr("src","data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="),f.attr("src",t),n.fire("request",{image:f})},hasLink:function(e){var t=this;return t.getLink(e)},hasNext:function(){var e=this;return e.hasLink(e.get("currentIndex")+1)},hasPrev:function(){var e=this;return e.hasLink(e.get("currentIndex")-1)},hideControls:function(){var e=this;e.get("controlLeftEl").hide(),e.get("controlRightEl").hide(),e.get("closeEl").hide()},next:function(){var e=this;e.hasNext()&&(e.set("currentIndex",e.get("currentIndex")+1),e.show())},preloadAllImages:function(){var e=this;e.get("links").each(function(t,n){e.preloadImage(n)})},preloadImage:function(e){var t=this,n=t.getLink(e);if(n){var r=n.attr("href");t._createPreloadImage(r)}},prev:function(){var e=this;e.hasPrev()&&(e.set("currentIndex",e.get("currentIndex")-1),e.show())},showLoading:function(){var e=this,t=e.get("loadingEl");e.setStdModContent("body",t),t.center(e.bodyNode)},show:function(){var e=this,t=e.getCurrentLink();t&&(q.superclass.show.apply(this,arguments),e.loadImage(t.attr("href")))},_clearPreloadImageFn:function(){var e=this,t=e._preloadImagePool,n;for(var r in t)n=t[r],n&&n.complete&&(t[r]=null)},_createPreloadImage:function(t){var n=this,r=n._preloadImagePool;r||(r=n._preloadImagePool={},n._clearPreloadImageTask=e.debounce(n._clearPreloadImageFn,50,n));if(!(t in r)){var i=new Image;i.onload=n._clearPreloadImageTask,i.src=t,r[t]=i}},_renderControls:function(){var t=this,n=e.one("body");n.append(t.get("controlLeftEl").hide()),n.append(t.get("controlRightEl").hide()),n.append(t.get("closeEl").hide())},_renderFooter:function(){var e=this,t=e.get("boundingBox"),n=t.get("ownerDocument").invoke("createDocumentFragment");n.append(e.get("captionEl")),n.append(e.get("infoEl")),e.setStdModContent("footer",n)},_syncCaptionUI:function(){var e=this,t=e.get("caption"),n=e.get("captionEl"),r=e.get("captionFromTitle");if(r){var i=e.getCurrentLink();if(i){var s=i.attr("title");s&&(t=i.attr("title"))}}n.html(t)},_syncControlsUI:function(){var e=this,t=e.get("boundingBox"),n=e.get("controlLeftEl"),r=e.get("controlRightEl"),i=e.get("closeEl");if(e.get("visible")){if(e.get("showControls")){var s=t.get("viewportRegion"),o=Math.floor(s.height/2)+s.top;n[e.hasPrev()?"show":"hide"](),r[e.hasNext()?"show":"hide"](),i.show()}}else e.hideControls()},_syncImageViewerUI:function(){var e=this;e._syncControlsUI(),e._syncCaptionUI(),e._syncInfoUI()},_syncInfoUI:function(){var e=this,t=e.get("infoEl");t.html(e.get("infoTemplate"))},_getRatio:function(e,t){var n=this,r=1,i=n.get("maxHeight"),s=n.get("maxWidth");if(t>i||e>s){var o=t/i,u=e/s;r=Math.max(o,u)}return r},_getInfoTemplate:function(e){var t=this,r=t.get("totalLinks"),i=t.get("currentIndex")+1;return n.sub(e,{current:i,total:r})},_displayLoadedImage:function(e){var t=this;t._uiSetImageSize(e),t.setStdModContent("body",e),t.set("loading",!1),t._syncImageViewerUI(),t._setAlignCenter(!0),t.fire("load",{image:e});if(t.get("preloadNeighborImages")){var n=t.get("currentIndex");t.preloadImage(n+1),t.preloadImage(n-1)}},_afterRender:function(){var e=this,t=e.bodyNode,n=e.get("boundingBox");t.addClass(g),n.addClass(L),e.get("preloadAllImages")&&e.preloadAllImages()},_afterLoadingChange:function(e){var t=this,n=t.get("boundingBox"
);e.newVal?(n.addClass(N),t.showLoading()):n.removeClass(N)},_afterVisibleChange:function(e){var t=this;t._syncControlsUI()},_onClickCloseEl:function(e){var t=this;t.close(),e.halt()},_onClickLeftControl:function(e){var t=this;t.prev(),e.halt()},_onClickRightControl:function(e){var t=this;t.next(),e.halt()},_onClickLinks:function(e){var t=this,n=e.currentTarget;t.set("currentIndex",t.get("links").indexOf(n)),t.show(),e.preventDefault()},_onKeyInteraction:function(e){var t=this;if(!t.get("visible"))return!1;e.isKey("LEFT")?t.prev():e.isKey("RIGHT")?t.next():e.isKey("ESC")&&t.close()},_onLoadImage:function(e){var t=this,n=e.currentTarget;t._displayLoadedImage(n);var r=t.get("imageAnim");t.get("anim")&&(n.setStyle("opacity",0),n.fx||n.plug(u,r),n.fx.on("end",function(e){t.fire("anim",{anim:e,image:n})}),n.fx.stop().run())},_uiSetImageSize:function(e){var t=this,n=t.bodyNode,r=t.footerNode,i=e.get("region"),s=t._getRatio(i.width,i.height),o=i.height/s,u=i.width/s;e.set("offsetHeight",o),e.set("offsetWidth",u),r.setStyle("width",u+"px"),n.setStyles({height:o+"px",width:u+"px"})}},{NAME:"image-viewer",CSS_PREFIX:c("image-viewer"),ATTRS:{anim:{value:!0,validator:r},bodyContent:{value:O},caption:{value:"blank",validator:o},captionFromTitle:{value:!0,validator:r},centered:{value:!0},currentIndex:{value:0,validator:i},image:{readOnly:!0,valueFn:function(){return e.Node.create(B)}},imageAnim:{value:{},setter:function(t){return e.merge({to:{opacity:1},duration:.8},t)},validator:s},infoTemplate:{getter:function(e){return this._getInfoTemplate(e)},value:M,validator:o},links:{setter:function(t){var n=this;return f(t)?t:o(t)?e.all(t):new e.NodeList([t])}},loading:{value:!1,validator:r},modal:{value:!0},preloadAllImages:{value:!1,validator:r},preloadNeighborImages:{value:!0,validator:r},showClose:{value:!0,validator:r},showControls:{value:!0,validator:r},tabIndex:{value:null},totalLinks:{readOnly:!0,getter:function(e){return this.get("links").size()}},visible:{value:!1},zIndex:{value:3e3,validator:i},controlLeftEl:{readOnly:!0,valueFn:function(){return e.Node.create(P)}},controlRightEl:{readOnly:!0,valueFn:function(){return e.Node.create(H)}},captionEl:{readOnly:!0,valueFn:function(){return e.Node.create(_)}},closeEl:{readOnly:!0,valueFn:function(){return e.Node.create(D)}},infoEl:{readOnly:!0,valueFn:function(){return e.Node.create(j)}},loader:{readOnly:!0,valueFn:function(){return e.Node.create(F).appendTo(a.body)}},loadingEl:{valueFn:function(){return e.Node.create(I)}},maxHeight:{value:Infinity,validator:i},maxWidth:{value:Infinity,validator:i}}});e.ImageViewer=q},"2.5.0",{requires:["anim","widget","widget-modality","widget-position","widget-position-align","widget-position-constrain","widget-stack","widget-stdmod","aui-event","aui-node-base","aui-widget-cssclass","aui-widget-toggle"],skinnable:!0});
