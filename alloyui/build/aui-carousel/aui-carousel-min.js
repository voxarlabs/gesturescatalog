YUI.add("aui-carousel",function(e,t){var n=e.Lang,r=e.getClassName,i=r("carousel","item"),s=r("carousel","item","active"),o=r("carousel","item","transition"),u=r("carousel","menu","active"),a=r("carousel","menu","index"),f=r("carousel","menu","item"),l=r("carousel","menu","next"),c=r("carousel","menu","play"),h=r("carousel","menu","pause"),p=r("carousel","menu","prev"),d=[f,a].join(" "),v=[f,a,u].join(" "),m="."+a,g="."+l,y="."+h,b="."+c,w=[b,y].join(),E="."+p,S='<li><a class="'+f+' {cssClasses}">{index}</a></li>',x='<menu><li><a class="'+f+" "+c+'"></a></li>'+'<li><a class="'+f+" "+p+'"></a></li>'+"{items}"+'<li><a class="'+f+" "+l+'"></a></li>'+"</menu>",T=e.Widget.UI_SRC,N={src:T},C=e.Component.create({NAME:"carousel",ATTRS:{activeIndex:{value:0,setter:"_setActiveIndex"},animationTime:{value:.5},intervalTime:{value:2},itemSelector:{value:">*"},nodeMenu:{value:null,setter:"_setNodeMenu"},nodeMenuItemSelector:{value:"."+f},pauseOnHover:{value:!1,validator:n.isBoolean},playing:{value:!0}},UI_ATTRS:["pauseOnHover"],prototype:{animation:null,nodeSelection:null,nodeMenu:null,hoverEventHandles:null,initializer:function(){var t=this;t.animation=new e.Anim({duration:t.get("animationTime"),to:{opacity:1}})},renderUI:function(){var e=this;e._updateNodeSelection(),e.nodeMenu=e.get("nodeMenu"),e._updateMenuNodes()},bindUI:function(){var e=this;e.after({activeIndexChange:e._afterActiveIndexChange,animationTimeChange:e._afterAnimationTimeChange,intervalTimeChange:e._afterIntervalTimeChange,itemSelectorChange:e._afterItemSelectorChange,nodeMenuItemSelector:e._afterNodeMenuItemSelectorChange,playingChange:e._afterPlayingChange}),e._bindMenu(),e.get("playing")===!0&&e._afterPlayingChange({prevVal:!1,newVal:!0})},syncUI:function(){var e=this;e._uiSetActiveIndex(e.get("activeIndex"))},item:function(e){var t=this;t.set("activeIndex",e)},next:function(){var e=this;e._updateIndexNext()},pause:function(){var e=this;e.set("playing",!1)},play:function(){var e=this;e.set("playing",!0)},prev:function(){var e=this;e._updateIndexPrev()},_afterActiveIndexChange:function(e){var t=this;t._uiSetActiveIndex(e.newVal,{prevVal:e.prevVal,animate:t.get("playing"),src:e.src})},_afterAnimationTimeChange:function(e){var t=this;t.animation.set("duration",e.newVal)},_afterItemSelectorChange:function(e){var t=this;t._updateNodeSelection()},_afterNodeMenuItemSelectorChange:function(e){var t=this;t.nodeMenuItemSelector=e.newVal,t._updateMenuNodes()},_afterIntervalTimeChange:function(e){var t=this;t._clearIntervalRotationTask(),t._createIntervalRotationTask()},_afterPlayingChange:function(e){var t=this,n=t.nodeMenu.one(w),r=e.newVal,i=h,s=c,o="_clearIntervalRotationTask";r&&(i=c,s=h,o="_createIntervalRotationTask"),t[o](),n&&n.replaceClass(i,s)},_bindMenu:function(){var e=this,t=e.nodeMenu,n=e.get("nodeMenuItemSelector");t.delegate("click",e._onClickDelegate,n,e),e.nodeMenuItemSelector=n},_clearIntervalRotationTask:function(){var e=this;clearInterval(e._intervalRotationTask)},_createIndexRandom:function(){var e=this;return Math.ceil(Math.random()*e.nodeSelection.size())-1},_createIntervalRotationTask:function(){var e=this;e._clearIntervalRotationTask(),e._intervalRotationTask=setInterval(function(){e._updateIndexNext({animate:!0})},e.get("intervalTime")*1e3)},_onAnimationEnd:function(e,t,n,r,i){var s=this;n&&n.removeClass(o),t.setStyle("opacity","1")},_onAnimationStart:function(e,t,n,r,i){var a=this;t.addClass(s),r&&r.addClass(u),n&&n.replaceClass(s,o),i&&i.removeClass(u)},_onClickDelegate:function(e){var t=this;e.preventDefault();var n=e.currentTarget,r;n.hasClass(a)?r=t._onMenuItemClick:n.hasClass(p)?r=t._updateIndexPrev:n.hasClass(l)?r=t._updateIndexNext:n.test(w)&&(r=t._onMenuPlayClick),r&&r.apply(t,arguments)},_onMenuItemClick:function(e){var t=this;e.preventDefault();var n=t.menuNodes.indexOf(e.currentTarget);t.set("activeIndex",n,N)},_onMenuPlayClick:function(e){var t=this;this.set("playing",!this.get("playing"))},_renderMenu:function(){var t=this,r=t.get("activeIndex"),i=[],s,o=t.nodeSelection.size();for(s=0;s<o;s++)i.push(n.sub(S,{cssClasses:r===s?v:d,index:s}));var u=e.Node.create(n.sub(x,{items:i.join(" ")}));return t.get("contentBox").appendChild(u),u},_setActiveIndex:function(e){var t=this;return e=="rand"?e=t._createIndexRandom():e=Math.max(Math.min(e,t.nodeSelection.size()),-1),e},_setNodeMenu:function(t){var n=this;return e.one(t)||n._renderMenu()},_uiSetActiveIndex:function(e,t){var r=this,i=null,u=null,a=null,f=null,l=r.nodeSelection.item(e),c=r.menuNodes,h=c.item(e);r.animation.set("node",l);if(t&&!n.isUndefined(t.prevVal)){var p=t.prevVal;l.setStyle("opacity","0"),u=c.item(p),i=r.nodeSelection.item(p),i.replaceClass(s,o),r.animation.stop()}else l.addClass(s),l.setStyle("opacity","1");a=r.animation.on("start",function(e){r._onAnimationStart(e,l,i,h,u),a.detach()}),f=r.animation.on("end",function(e){r._onAnimationEnd(e,l,i,h,u),f.detach()}),t&&(t.animate?r.animation.run():(r.animation.fire("start"),r.animation.fire("end")),t.src==T&&t.animate&&r._createIntervalRotationTask())},_uiSetPauseOnHover:function(t){var n=this.get("boundingBox");if(t){if(this.hoverEventHandles)return;this.hoverEventHandles=[n.on("mouseenter",e.bind(this.pause,this)),n.on("mouseleave",e.bind(this.play,this))]}else(new e.EventHandle(instance.hoverEventHandles)).detach(),this.hoverEventHandles=null},_updateIndexNext:function(e){var t=this,n=t.get("activeIndex"),r=t.nodeSelection.size(),i=n+1;i>r-1&&(i=0),e&&(e.src=T),t.set("activeIndex",i,e)},_updateIndexPrev:function(e){var t=this,n=t.get("activeIndex"),r=n-1;r<0&&(r=t.nodeSelection.size()-1),e&&(e.src=T),t.set("activeIndex",r,e)},_updateMenuNodes:function(){var e=this;e.menuNodes=e.nodeMenu.all(m)},_updateNodeSelection:function(){var e=this,t=e.get("itemSelector"),n=e.get("contentBox").all(t);n.addClass(i),e.nodeSelection=n},_intervalRotationTask:null}});e.Carousel=C},"2.5.0",{requires:["anim","node-event-delegate","aui-component"],skinnable:!0});
